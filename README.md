# 基于P2P的文件传输工具

1. 项目概述
本项目是一个基于局域网（或本地测试环境）的简易P2P文件传输程序，目前处于未完成状态。核心功能包括用户注册、在线列表管理、消息广播以及基础文件信息管理，但完整的P2P文件传输逻辑尚未实现。程序分为客户端和服务器端，服务器负责协调用户连接，客户端之间通过服务器发现彼此，未来计划实现直接文件传输。

2. 系统架构
模块划分
客户端 (Client 包)

Client：处理与服务器的连接、消息收发、用户注册。

ClientFrame：客户端图形界面，支持输入消息、连接服务器。

ClientMain：客户端主窗口启动类。

服务器 (Server 包)

Server：核心服务逻辑，管理用户连接、广播消息。

CreateServerThread：处理单个客户端连接，维护在线用户列表。

ServerFrame：服务器图形界面，显示日志并支持广播消息。

ServerMain：服务器主窗口启动类。

公共组件 (AllNeed 包)

FileInfo：定义文件分块信息及哈希计算逻辑。

NodeInfo：封装节点信息（设计用途，当前未完全集成）。

FileListManager：管理本地文件分块和哈希生成，支持文件列表广播。

3. 已实现功能
客户端
用户通过 用户名#端口号 格式注册到服务器。

支持发送普通消息和命令（如 ls 查询在线用户）。

图形界面显示消息记录和连接状态。

服务器
监听固定端口（10001），接收客户端连接。

维护在线用户列表，支持广播消息给所有客户端。

响应客户端命令（如 ls 返回在线列表、help 显示帮助）。

文件管理（部分实现）
FileListManager 可扫描指定文件夹（file/），生成文件分块信息（大小、哈希）。

服务器支持 filelist 或 fl 命令，返回格式化文件列表（包含文件名、分块数、哈希值）。

4. 依赖与环境
语言：Java 8+

依赖库：Swing（图形界面）、Java NIO（文件操作）。

运行要求：

服务器需先启动，客户端连接时指定服务器IP（默认 localhost）。

文件管理功能需在项目根目录下创建 file/ 文件夹存放待传输文件。

5. 使用方法
启动服务器
运行 ServerMain 类。

服务器窗口显示连接日志，输入消息并点击 Broadcast 可广播给所有客户端。

启动客户端
运行 ClientMain 类。

输入服务器IP（默认 localhost），点击 Connect。

输入 用户名#端口号（如 Alice#12345）完成注册。

发送消息或命令（如 ls）。

6. 待完成任务
核心功能缺失
P2P文件传输：

客户端之间直接通信逻辑（当前依赖服务器中转）。

文件分块传输、校验和重组逻辑。

节点发现机制（依赖 NodeInfo 类，当前未集成）。

文件管理增强：

文件上传/下载的界面交互。

分块传输的进度监控和断点续传。

优化与修复
代码改进：

Client 类中 checkmessage 方法的循环逻辑可能导致界面卡顿。

FileInfo.calculateHash 存在潜在错误（ByteArrayInputStream 转换问题）。

功能增强：

支持动态端口分配和NAT穿透。

添加心跳机制检测节点在线状态。

7. 后续开发建议
实现P2P通信：

客户端注册后，通过服务器获取其他节点的IP和端口，建立直接Socket连接。

基于 FileListManager 的分块信息，实现按需请求文件块。

完善图形界面：

添加文件选择对话框和传输进度条。

支持拖拽文件上传和双击下载。

增强鲁棒性：

增加传输失败重试机制。

优化多线程同步问题（如 userThreads 的并发访问）。

8. 注意事项
当前版本仅为原型，未处理大量并发或安全验证。

测试时需确保防火墙允许端口通信（如 10001 和客户端指定端口）。

项目仓库：https://github.com/0LinKun/p2papp
联系方式：whitesky2022@163.com